import ScribeFlowPlugin from '../../main';
import { MarkdownRenderer, Component } from 'obsidian';

export class InspirationsTab {
	containerEl: HTMLElement;
	plugin: ScribeFlowPlugin;
	private contentEl: HTMLElement;
	private markdownComponent: Component | null = null;

	constructor(containerEl: HTMLElement, plugin: ScribeFlowPlugin) {
		this.containerEl = containerEl;
		this.plugin = plugin;

		// Create dedicated content element for this tab
		this.contentEl = containerEl.createDiv('sfp-tab-content sfp-inspirations-tab');
	}

	async display(): Promise<void> {
		this.contentEl.classList.add('active');
		// Only render if not already rendered
		if (this.contentEl.children.length === 0) {
			const content = `## Sources and Inspirations

### Foundational Concepts

The metrics and tracking concepts in ScribeFlow are inspired by established practices in dream research, psychology, and qualitative data analysis. While no single source dictates the exact formulation of each metric, the development has been informed by general principles found in these fields:

#### Dream Journaling Practices

The practice of recording dream content, including sensory details, emotions, and narrative flow, is a well-established method for improving dream recall and understanding. ScribeFlow builds on these traditional approaches by adding structure and quantification to the journaling process.

Dream journaling has been inspired by the broader principles of numerous researchers and practitioners, including:

- Robert Van de Castle's work on dream content analysis
- Stephen LaBerge's research on lucid dreaming
- G. William Domhoff's studies on dream content and meaning

#### Qualitative Research Methodologies

Several approaches from qualitative research have influenced how ScribeFlow breaks down dream experiences into measurable components:

- **Content Analysis**: Systematically categorizing elements within narratives
- **Thematic Analysis**: Identifying patterns and themes across multiple accounts
- **Phenomenological Approaches**: Capturing the essence of subjective experiences

These methodologies provide the theoretical foundation for transforming subjective dream experiences into data that can be analyzed over time.

#### Cognitive Psychology and Memory Research

Understanding how memory works, particularly the nature of dream recall and its fallibility, informs several ScribeFlow features:

- Metrics like "Lost Segments" acknowledge the fragmentary nature of dream recall
- "Confidence Score" reflects research on metamemory (how we assess our own memory accuracy)
- The focus on immediate recording aligns with findings about memory degradation over time

### Specific Metric Inspirations

#### Sensory and Perceptual Metrics

- **Sensory Detail**: Draws from research on mental imagery vividness and sensory perception studies
- **Visual Clarity**: Influenced by dream imagery research and visual memory studies

#### Memory and Awareness Metrics

- **Emotional Recall**: Reflects research on emotional memory and affective neuroscience
- **Lost Segments**: Inspired by studies on memory fragmentation and the reconstructive nature of recall
- **Confidence Score**: Based on metacognitive research on certainty judgments

#### Dream Content Metrics

- **Characters Count/List**: Influenced by Hall and Van de Castle's system of dream content analysis
- **Environmental Familiarity**: Draws from research on place recognition and environmental psychology
- **Dream Theme**: Inspired by archetypal and thematic approaches to dream interpretation

#### Lucidity and Awareness

- **Lucidity Level**: Directly informed by research from lucid dreaming studies, particularly the work of Stephen LaBerge and Tholey's reflective awareness scale

### Methodological Influences

#### Rating Scales

The use of 1-5 scales for subjective assessments is a widely adopted practice in psychological research to quantify qualitative experiences. This approach balances:

- Sufficient granularity to capture meaningful differences
- Simplicity that avoids overwhelming users with too many options
- Consistency with common research methodologies

#### Data Visualization Approaches

The calendar visualization and metrics displays are informed by:

- Time-series data visualization principles
- Dashboard design best practices
- User experience research on information density and accessibility

### Conclusion

ScribeFlow provides a flexible framework built upon these general understandings, allowing individuals to tailor their dream tracking to their personal exploration goals. The specific metrics and their scoring guidelines were developed through an iterative process aimed at creating a practical and insightful tool for Obsidian users.

The plugin does not prescribe any particular interpretation or meaning to dream content - it simply provides tools to help users discover their own patterns and insights through consistent tracking and reflection.`;

			// Create a new component for markdown rendering
			this.markdownComponent = new Component();
			await MarkdownRenderer.render(this.plugin.app, content, this.contentEl, '', this.markdownComponent);
		}
	}

	hide(): void {
		this.contentEl.classList.remove('active');
		// Unload the markdown component to prevent memory leaks
		if (this.markdownComponent) {
			this.markdownComponent.unload();
			this.markdownComponent = null;
		}
	}
}
